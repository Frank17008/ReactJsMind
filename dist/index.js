!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports["@frank17008/react-jsmind"]=t(require("react")):e["@frank17008/react-jsmind"]=t(e.react)}(self,(e=>(()=>{var t={802:function(e){!function(t){"use strict";var n=function(){return{escape:function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:t,mimeType:function(e){var n=t(e).toLowerCase();return(i="application/font-woff",o="image/jpeg",{woff:i,woff2:i,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:o,jpeg:o,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[n]||"";var i,o},dataAsUrl:function(e,t){return"data:"+t+";base64,"+e},isDataUrl:function(e){return-1!==e.search(/^(data:)/)},canvasToBlob:function(e){return e.toBlob?new Promise((function(t){e.toBlob(t)})):function(e){return new Promise((function(t){for(var n=window.atob(e.toDataURL().split(",")[1]),i=n.length,o=new Uint8Array(i),r=0;r<i;r++)o[r]=n.charCodeAt(r);t(new Blob([o],{type:"image/png"}))}))}(e)},resolveUrl:function(e,t){var n=document.implementation.createHTMLDocument(),i=n.createElement("base");n.head.appendChild(i);var o=n.createElement("a");return n.body.appendChild(o),i.href=t,o.href=e,o.href},getAndEncode:function(e){var t=3e4;a.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());return new Promise((function(n){var i,o=new XMLHttpRequest;if(o.onreadystatechange=s,o.ontimeout=l,o.responseType="blob",o.timeout=t,o.open("GET",e,!0),o.send(),a.impl.options.imagePlaceholder){var r=a.impl.options.imagePlaceholder.split(/,/);r&&r[1]&&(i=r[1])}function s(){if(4===o.readyState)if(200===o.status){var t=new FileReader;t.onloadend=function(){var e=t.result.split(/,/)[1];n(e)},t.readAsDataURL(o.response)}else i?n(i):d("cannot fetch resource: "+e+", status: "+o.status)}function l(){i?n(i):d("timeout of "+t+"ms occured while fetching resource: "+e)}function d(e){n("")}}))},uid:(e=0,function(){return"u"+t()+e++;function t(){return("0000"+(Math.random()*Math.pow(36,4)|0).toString(36)).slice(-4)}}),delay:function(e){return function(t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))}},asArray:function(e){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t},escapeXhtml:function(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(e){return new Promise((function(t,n){var i=new Image;i.onload=function(){t(i)},i.onerror=n,i.src=e}))},width:function(e){var t=n(e,"border-left-width"),i=n(e,"border-right-width");return e.scrollWidth+t+i},height:function(e){var t=n(e,"border-top-width"),i=n(e,"border-bottom-width");return e.scrollHeight+t+i}};var e;function t(e){var t=/\.([^\.\/]*?)$/g.exec(e);return t?t[1]:""}function n(e,t){var n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}}(),i=function(){var e=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(e,n,r){return s()?Promise.resolve(e):Promise.resolve(e).then(i).then((function(t){var i=Promise.resolve(e);return t.forEach((function(e){i=i.then((function(t){return o(t,e,n,r)}))})),i}));function s(){return!t(e)}},shouldProcess:t,impl:{readUrls:i,inline:o}};function t(t){return-1!==t.search(e)}function i(t){for(var i,o=[];null!==(i=e.exec(t));)o.push(i[1]);return o.filter((function(e){return!n.isDataUrl(e)}))}function o(e,t,i,o){return Promise.resolve(t).then((function(e){return i?n.resolveUrl(e,i):e})).then(o||n.getAndEncode).then((function(e){return n.dataAsUrl(e,n.mimeType(t))})).then((function(i){return e.replace(function(e){return new RegExp("(url\\(['\"]?)("+n.escape(e)+")(['\"]?\\))","g")}(t),"$1"+i+"$3")}))}}(),o=function(){return{resolveAll:function(){return e(document).then((function(e){return Promise.all(e.map((function(e){return e.resolve()})))})).then((function(e){return e.join("\n")}))},impl:{readAll:e}};function e(){return Promise.resolve(n.asArray(document.styleSheets)).then((function(e){var t=[];return e.forEach((function(e){try{n.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(e){}})),t})).then((function(e){return e.filter((function(e){return e.type===CSSRule.FONT_FACE_RULE})).filter((function(e){return i.shouldProcess(e.style.getPropertyValue("src"))}))})).then((function(t){return t.map(e)}));function e(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return i.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue("src")}}}}}(),r=function(){return{inlineAll:function t(o){return o instanceof Element?r(o).then((function(){return o instanceof HTMLImageElement?e(o).inline():Promise.all(n.asArray(o.childNodes).map((function(e){return t(e)})))})):Promise.resolve(o);function r(e){var t=e.style.getPropertyValue("background");return t?i.inlineAll(t).then((function(t){e.style.setProperty("background",t,e.style.getPropertyPriority("background"))})).then((function(){return e})):Promise.resolve(e)}},impl:{newImage:e}};function e(e){return{inline:function(t){return n.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||n.getAndEncode).then((function(t){return n.dataAsUrl(t,n.mimeType(e.src))})).then((function(t){return new Promise((function(n,i){e.onload=n,e.onerror=i,e.src=t}))}))}}}}(),s={imagePlaceholder:void 0,cacheBust:!1},a={toSvg:l,toPng:function(e,t){return d(e,t||{}).then((function(e){return e.toDataURL()}))},toJpeg:function(e,t){return d(e,t=t||{}).then((function(e){return e.toDataURL("image/jpeg",t.quality||1)}))},toBlob:function(e,t){return d(e,t||{}).then(n.canvasToBlob)},toPixelData:function(e,t){return d(e,t||{}).then((function(t){return t.getContext("2d").getImageData(0,0,n.width(e),n.height(e)).data}))},impl:{fontFaces:o,images:r,util:n,inliner:i,options:{}}};function l(e,t){return function(e){void 0===e.imagePlaceholder?a.impl.options.imagePlaceholder=s.imagePlaceholder:a.impl.options.imagePlaceholder=e.imagePlaceholder;void 0===e.cacheBust?a.impl.options.cacheBust=s.cacheBust:a.impl.options.cacheBust=e.cacheBust}(t=t||{}),Promise.resolve(e).then((function(e){return h(e,t.filter,!0)})).then(_).then(u).then((function(e){t.bgcolor&&(e.style.backgroundColor=t.bgcolor);t.width&&(e.style.width=t.width+"px");t.height&&(e.style.height=t.height+"px");t.style&&Object.keys(t.style).forEach((function(n){e.style[n]=t.style[n]}));return e})).then((function(i){return function(e,t,i){return Promise.resolve(e).then((function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(e)})).then(n.escapeXhtml).then((function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"})).then((function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+i+'">'+e+"</svg>"})).then((function(e){return"data:image/svg+xml;charset=utf-8,"+e}))}(i,t.width||n.width(e),t.height||n.height(e))}))}function d(e,t){return l(e,t).then(n.makeImage).then(n.delay(100)).then((function(i){var o=function(e){var i=document.createElement("canvas");if(i.width=t.width||n.width(e),i.height=t.height||n.height(e),t.bgcolor){var o=i.getContext("2d");o.fillStyle=t.bgcolor,o.fillRect(0,0,i.width,i.height)}return i}(e);return o.getContext("2d").drawImage(i,0,0),o}))}function h(e,t,i){return i||!t||t(e)?Promise.resolve(e).then((function(e){return e instanceof HTMLCanvasElement?n.makeImage(e.toDataURL()):e.cloneNode(!1)})).then((function(i){return function(e,t,i){var o=e.childNodes;return 0===o.length?Promise.resolve(t):r(t,n.asArray(o),i).then((function(){return t}));function r(e,t,n){var i=Promise.resolve();return t.forEach((function(t){i=i.then((function(){return h(t,n)})).then((function(t){t&&e.appendChild(t)}))})),i}}(e,i,t)})).then((function(t){return function(e,t){return t instanceof Element?Promise.resolve().then(i).then(o).then(r).then(s).then((function(){return t})):t;function i(){function i(e,t){function i(e,t){n.asArray(e).forEach((function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))}))}e.cssText?t.cssText=e.cssText:i(e,t)}i(window.getComputedStyle(e),t.style)}function o(){function i(i){var o=window.getComputedStyle(e,i),r=o.getPropertyValue("content");if(""!==r&&"none"!==r){var s=n.uid();t.className=t.className+" "+s;var a=document.createElement("style");a.appendChild(l(s,i,o)),t.appendChild(a)}function l(e,t,i){var o="."+e+":"+t,r=i.cssText?s(i):a(i);return document.createTextNode(o+"{"+r+"}");function s(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}function a(e){return n.asArray(e).map(t).join("; ")+";";function t(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")}}}}[":before",":after"].forEach((function(e){i(e)}))}function r(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function s(){t instanceof SVGElement&&(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t instanceof SVGRectElement&&["width","height"].forEach((function(e){var n=t.getAttribute(e);n&&t.style.setProperty(e,n)})))}}(e,t)})):Promise.resolve()}function _(e){return o.resolveAll().then((function(t){var n=document.createElement("style");return e.appendChild(n),n.appendChild(document.createTextNode(t)),e}))}function u(e){return r.inlineAll(e).then((function(){return e}))}e.exports=a}()},114:function(e,t,n){!function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e);if(!n.default)throw new Error("jsMind is not defined");const i=n.default.$,o="getSelection"in i.w?function(){i.w.getSelection().removeAllRanges()}:function(){i.d.selection.empty()},r={line_width:5,line_color:"rgba(0,0,0,0.3)",line_color_invalid:"rgba(255,51,51,0.6)",lookup_delay:200,lookup_interval:100,scrolling_trigger_width:20,scrolling_step_length:10,shadow_node_class_name:"jsmind-draggable-shadow-node"};class s{constructor(e,t){var i={};n.default.util.json.merge(i,r),n.default.util.json.merge(i,t),this.version="0.4.0",this.jm=e,this.options=i,this.e_canvas=null,this.canvas_ctx=null,this.shadow=null,this.shadow_p_x=0,this.shadow_p_y=0,this.shadow_w=0,this.shadow_h=0,this.active_node=null,this.target_node=null,this.target_direct=null,this.client_w=0,this.client_h=0,this.offset_x=0,this.offset_y=0,this.hlookup_delay=0,this.hlookup_timer=0,this.capture=!1,this.moved=!1,this.canvas_draggable=e.get_view_draggable(),this.view_panel=e.view.e_panel,this.view_panel_rect=null}init(){this.create_canvas(),this.create_shadow(),this.event_bind()}resize(){this.jm.view.e_nodes.appendChild(this.shadow),this.e_canvas.width=this.jm.view.size.w,this.e_canvas.height=this.jm.view.size.h}create_canvas(){var e=i.c("canvas");this.jm.view.e_panel.appendChild(e);var t=e.getContext("2d");this.e_canvas=e,this.canvas_ctx=t}create_shadow(){var e=i.c("jmnode");e.style.visibility="hidden",e.style.zIndex="3",e.style.cursor="move",e.style.opacity="0.7",e.className=this.options.shadow_node_class_name,this.shadow=e}reset_shadow(e){var t=this.shadow.style;this.shadow.innerHTML=e.innerHTML,t.left=e.style.left,t.top=e.style.top,t.width=e.style.width,t.height=e.style.height,t.backgroundImage=e.style.backgroundImage,t.backgroundSize=e.style.backgroundSize,t.transform=e.style.transform,this.shadow_w=this.shadow.clientWidth,this.shadow_h=this.shadow.clientHeight}show_shadow(){this.moved||(this.shadow.style.visibility="visible")}hide_shadow(){this.shadow.style.visibility="hidden"}magnet_shadow(e,t,n){this.canvas_ctx.lineWidth=this.options.line_width,this.canvas_ctx.strokeStyle=n?this.options.line_color_invalid:this.options.line_color,this.canvas_ctx.lineCap="round",this.clear_lines(),this.canvas_lineto(e.x,e.y,t.x,t.y)}clear_lines(){this.canvas_ctx.clearRect(0,0,this.jm.view.size.w,this.jm.view.size.h)}canvas_lineto(e,t,n,i){this.canvas_ctx.beginPath(),this.canvas_ctx.moveTo(e,t),this.canvas_ctx.lineTo(n,i),this.canvas_ctx.stroke()}event_bind(){var e=this,t=this.jm.view.container;i.on(t,"mousedown",(function(t){0===t.button&&e.dragstart.call(e,t)})),i.on(t,"mousemove",(function(t){0===t.movementX&&0===t.movementY||e.drag.call(e,t)})),i.on(t,"mouseup",(function(t){e.dragend.call(e,t)})),i.on(t,"touchstart",(function(t){e.dragstart.call(e,t)})),i.on(t,"touchmove",(function(t){e.drag.call(e,t)})),i.on(t,"touchend",(function(t){e.dragend.call(e,t)}))}dragstart(e){if(this.jm.get_editable()&&!this.capture){this.active_node=null,this.view_draggable=this.jm.get_view_draggable();var t=this.jm.view,n=this.find_node_element(e.target);if(n){this.view_draggable&&this.jm.disable_view_draggable();var o=t.get_binded_nodeid(n);if(o){var r=this.jm.get_node(o);if(!r.isroot){this.reset_shadow(n),this.view_panel_rect=this.view_panel.getBoundingClientRect(),this.active_node=r,this.offset_x=(e.clientX||e.touches[0].clientX)/t.zoom_current-n.offsetLeft,this.offset_y=(e.clientY||e.touches[0].clientY)/t.zoom_current-n.offsetTop,this.client_hw=Math.floor(n.clientWidth/2),this.client_hh=Math.floor(n.clientHeight/2),0!=this.hlookup_delay&&i.w.clearTimeout(this.hlookup_delay),0!=this.hlookup_timer&&i.w.clearInterval(this.hlookup_timer);var s=this;this.hlookup_delay=i.w.setTimeout((function(){s.hlookup_delay=0,s.hlookup_timer=i.w.setInterval((function(){s.lookup_target_node.call(s)}),s.options.lookup_interval)}),this.options.lookup_delay),s.capture=!0}}}}}drag(e){if(this.jm.get_editable()&&this.capture){e.preventDefault(),this.show_shadow(),this.moved=!0,o();var t=this.jm.view,n=(e.clientX||e.touches[0].clientX)/t.zoom_current-this.offset_x,i=(e.clientY||e.touches[0].clientY)/t.zoom_current-this.offset_y;e.clientY-this.view_panel_rect.top<this.options.scrolling_trigger_width&&this.view_panel.scrollTop>this.options.scrolling_step_length?(this.view_panel.scrollBy(0,-this.options.scrolling_step_length),this.offset_y+=this.options.scrolling_step_length/t.zoom_current):this.view_panel_rect.bottom-e.clientY<this.options.scrolling_trigger_width&&this.view_panel.scrollTop<this.view_panel.scrollHeight-this.view_panel_rect.height-this.options.scrolling_step_length&&(this.view_panel.scrollBy(0,this.options.scrolling_step_length),this.offset_y-=this.options.scrolling_step_length/t.zoom_current),e.clientX-this.view_panel_rect.left<this.options.scrolling_trigger_width&&this.view_panel.scrollLeft>this.options.scrolling_step_length?(this.view_panel.scrollBy(-this.options.scrolling_step_length,0),this.offset_x+=this.options.scrolling_step_length/t.zoom_current):this.view_panel_rect.right-e.clientX<this.options.scrolling_trigger_width&&this.view_panel.scrollLeft<this.view_panel.scrollWidth-this.view_panel_rect.width-this.options.scrolling_step_length&&(this.view_panel.scrollBy(this.options.scrolling_step_length,0),this.offset_x-=this.options.scrolling_step_length/t.zoom_current),this.shadow.style.left=n+"px",this.shadow.style.top=i+"px",o()}}dragend(e){if(this.jm.get_editable()){if(this.view_draggable&&this.jm.enable_view_draggable(),this.capture){if(0!=this.hlookup_delay&&(i.w.clearTimeout(this.hlookup_delay),this.hlookup_delay=0,this.clear_lines()),0!=this.hlookup_timer&&(i.w.clearInterval(this.hlookup_timer),this.hlookup_timer=0,this.clear_lines()),this.moved){var t=this.active_node,n=this.target_node,o=this.target_direct;this.move_node(t,n,o)}this.hide_shadow()}this.view_panel_rect=null,this.moved=!1,this.capture=!1}}find_node_element(e){return e===this.jm.view.e_nodes||e===this.jm.view.e_panel||e===this.jm.view.container?null:"jmnode"===e.tagName.toLowerCase()?e:this.find_node_element(e.parentNode)}lookup_target_node(){let e=this.shadow.offsetLeft,t=this.shadow.offsetTop;if(e===this.shadow_p_x&&t===this.shadow_p_y)return;this.shadow_p_x=e,this.shadow_p_y=t;let i=this.shadow_p_x+this.shadow_w/2>=this.get_root_x()?n.default.direction.right:n.default.direction.left,o=this.lookup_overlapping_node_parent(i)||this.lookup_close_node(i);if(o){let e=this.calc_point_of_node(o,i),t=n.default.node.inherited(this.active_node,o);this.magnet_shadow(e.sp,e.np,t),this.target_node=o,this.target_direct=i}}get_root_x(){let e=this.jm.get_root(),t=e.get_location(),n=e.get_size();return t.x+n.w/2}lookup_overlapping_node_parent(e){let t=this.shadow.getBoundingClientRect(),n=t.x+t.width*(1-e)/2,i=(this.jm.options.layout.hspace+this.jm.options.layout.pspace)*e,o=t.height,r=[[n,t.y],[n,t.y+o/2],[n,t.y+o],[n+i/2,t.y],[n+i/2,t.y+o/2],[n+i/2,t.y+o],[n+i,t.y],[n+i,t.y+o/2],[n+i,t.y+o]];for(const e of r){let t=this.lookup_node_parent_by_location(e[0],e[1]);if(t)return t}}lookup_node_parent_by_location(e,t){return i.d.elementsFromPoint(e,t).filter((e=>"JMNODE"===e.tagName&&e.className!==this.options.shadow_node_class_name)).map((e=>this.jm.view.get_binded_nodeid(e))).map((e=>e&&this.jm.mind.nodes[e])).map((e=>e&&e.parent)).find((e=>e))}lookup_close_node(e){return Object.values(this.jm.mind.nodes).filter((t=>t.direction==e||t.isroot)).filter((e=>this.jm.layout.is_visible(e))).filter((t=>this.shadow_on_target_side(t,e))).map((t=>({node:t,distance:this.shadow_to_node(t,e)}))).reduce(((e,t)=>e.distance<t.distance?e:t),{node:this.jm.get_root(),distance:Number.MAX_VALUE}).node}shadow_on_target_side(e,t){return t==n.default.direction.right&&this.shadow_to_right_of_node(e)>0||t==n.default.direction.left&&this.shadow_to_left_of_node(e)>0}shadow_to_right_of_node(e){return this.shadow_p_x-e.get_location().x-e.get_size().w}shadow_to_left_of_node(e){return e.get_location().x-this.shadow_p_x-this.shadow_w}shadow_to_base_line_of_node(e){return this.shadow_p_y+this.shadow_h/2-e.get_location().y-e.get_size().h/2}shadow_to_node(e,t){return(t===n.default.direction.right?Math.abs(this.shadow_to_right_of_node(e)):Math.abs(this.shadow_to_left_of_node(e)))+Math.abs(this.shadow_to_base_line_of_node(e))}calc_point_of_node(e,t){let n=e.get_size(),i=e.get_location(),o=e.isroot?i.x+n.w/2:i.x+n.w*(1+t)/2+this.options.line_width*t,r=i.y+n.h/2;return{sp:{x:this.shadow_p_x+this.shadow_w*(1-t)/2-this.options.line_width*t,y:this.shadow_p_y+this.shadow_h/2},np:{x:o,y:r}}}move_node(e,t,i){var o=this.shadow.offsetTop;if(t&&e&&!n.default.node.inherited(e,t)){for(var r=t.children,s=r.length,a=null,l=Number.MAX_VALUE,d=null,h="_last_";s--;)if((a=r[s]).direction==i&&a.id!=e.id){var _=a.get_location().y-o;_>0&&_<l&&(l=_,d=a,h="_first_")}d&&(h=d.id),this.jm.move_node(e.id,h,t.id,i)}this.active_node=null,this.target_node=null,this.target_direct=null}jm_event_handle(e,t){e===n.default.event_type.resize&&this.resize()}}var a=new n.default.plugin("draggable_node",(function(e,t){var n=new s(e,t);n.init(),e.add_event_listener((function(e,t){n.jm_event_handle.call(n,e,t)}))}));n.default.register_plugin(a)}(n(900))},900:function(e){e.exports=function(){"use strict";const e="0.8.5";"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e});const t={left:-1,center:0,right:1,of:function(e){return e&&-1!==e&&0!==e&&1!==e?"-1"===e||"0"===e||"1"===e?parseInt(e):"left"===e.toLowerCase()?this.left:"right"===e.toLowerCase()?this.right:"center"===e.toLowerCase()?this.center:void 0:e}},n={show:1,resize:2,edit:3,select:4},i={debug:1,info:2,warn:3,error:4,disable:9};var o=function(){};let r="undefined"==typeof console?{level:o,log:o,debug:o,info:o,warn:o,error:o}:{level:function(e){r.debug=e>i.debug?o:console.debug,r.info=e>i.info?o:console.info,r.warn=e>i.warn?o:console.warn,r.error=e>i.error?o:console.error},log:console.log,debug:console.debug,info:console.info,warn:console.warn,error:console.error};const s=new class{constructor(e){this.w=e,this.d=e.document,this.g=function(e){return this.d.getElementById(e)},this.c=function(e){return this.d.createElement(e)},this.t=function(e,t){e.hasChildNodes()?e.firstChild.nodeValue=t:e.appendChild(this.d.createTextNode(t))},this.h=function(e,t){t instanceof HTMLElement?(e.innerHTML="",e.appendChild(t)):e.innerHTML=t},this.i=function(e){return!!e&&"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument},this.on=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}}}(window),a={file:{read:function(e,t){var n=new FileReader;n.onload=function(){"function"==typeof t&&t(this.result,e.name)},n.readAsText(e)},save:function(e,t,n){var i;if("function"==typeof s.w.Blob)i=new Blob([e],{type:t});else{var o=new(s.w.BlobBuilder||s.w.MozBlobBuilder||s.w.WebKitBlobBuilder||s.w.MSBlobBuilder);o.append(e),i=o.getBlob(t)}if(navigator.msSaveBlob)navigator.msSaveBlob(i,n);else{var r=(s.w.URL||s.w.webkitURL).createObjectURL(i),a=s.c("a");if("download"in a){a.style.visibility="hidden",a.href=r,a.download=n,s.d.body.appendChild(a);var l=s.d.createEvent("MouseEvents");l.initEvent("click",!0,!0),a.dispatchEvent(l),s.d.body.removeChild(a)}else location.href=r}}},json:{json2string:function(e){return JSON.stringify(e)},string2json:function(e){return JSON.parse(e)},merge:function(e,t){for(var n in t)n in e?"object"!=typeof e[n]||"[object object]"!=Object.prototype.toString.call(e[n]).toLowerCase()||e[n].length?e[n]=t[n]:a.json.merge(e[n],t[n]):e[n]=t[n];return e}},uuid:{newid:function(){return((new Date).getTime().toString(16)+Math.random().toString(16).substring(2)).substring(2,18)}},text:{is_empty:function(e){return!e||0==e.replace(/\s*/,"").length}}},l={container:"",editable:!1,theme:null,mode:"full",support_html:!0,log_level:"info",view:{engine:"canvas",enable_device_pixel_ratio:!1,hmargin:100,vmargin:50,line_width:2,line_color:"#555",line_style:"curved",draggable:!1,hide_scrollbars_when_draggable:!1,node_overflow:"hidden",zoom:{min:.5,max:2.1,step:.1},custom_node_render:null,expander_style:"char"},layout:{hspace:30,vspace:20,pspace:13,cousin_space:0},default_event_handle:{enable_mousedown_handle:!0,enable_click_handle:!0,enable_dblclick_handle:!0,enable_mousewheel_handle:!0},shortcut:{enable:!0,handles:{},mapping:{addchild:[45,4109],addbrother:13,editnode:113,delnode:46,toggle:32,left:37,up:38,right:39,down:40}},plugin:{}};class d{constructor(e,t,n,i,o,s,a,l){e?"number"==typeof t?(void 0===l&&(l=!0),this.id=e,this.index=t,this.topic=n,this.data=i||{},this.isroot=o,this.parent=s,this.direction=a,this.expanded=!!l,this.children=[],this._data={}):r.error("invalid node index"):r.error("invalid node id")}get_location(){var e=this._data.view;return{x:e.abs_x,y:e.abs_y}}get_size(){var e=this._data.view;return{w:e.width,h:e.height}}static compare(e,t){var n=e.index,i=t.index;return n>=0&&i>=0?n-i:-1==n&&-1==i?0:-1==n?1:-1==i?-1:0}static inherited(e,t){if(e&&t){if(e.id===t.id)return!0;if(e.isroot)return!0;for(var n=e.id,i=t;!i.isroot;)if((i=i.parent).id===n)return!0}return!1}static is_node(e){return!!e&&e instanceof d}}class h{constructor(){this.name=null,this.author=null,this.version=null,this.root=null,this.selected=null,this.nodes={}}get_node(e){return e in this.nodes?this.nodes[e]:(r.warn("the node[id="+e+"] can not be found"),null)}set_root(e,t,n){return null==this.root?(this.root=new d(e,0,t,n,!0),this._put_node(this.root),this.root):(r.error("root node is already exist"),null)}add_node(e,n,i,o,s,a,l){if(!d.is_node(e))return r.error("the parent_node "+e+" is not a node."),null;var h=new d(n,l||-1,i,o,!1,e,e.direction,a);return e.isroot&&(h.direction=s||t.right),this._put_node(h)?(e.children.push(h),this._update_index(e)):(r.error("fail, the node id '"+h.id+"' has been already exist."),h=null),h}insert_node_before(e,t,n,i,o){if(!d.is_node(e))return r.error("the node_before "+e+" is not a node."),null;var s=e.index-.5;return this.add_node(e.parent,t,n,i,o,!0,s)}get_node_before(e){if(!d.is_node(e)){var t=this.get_node(e);return t?this.get_node_before(t):(r.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;var n=e.index-2;return n>=0?e.parent.children[n]:null}insert_node_after(e,t,n,i,o){if(!d.is_node(e))return r.error("the node_after "+e+" is not a node."),null;var s=e.index+.5;return this.add_node(e.parent,t,n,i,o,!0,s)}get_node_after(e){if(!d.is_node(e)){var t=this.get_node(e);return t?this.get_node_after(t):(r.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;var n=e.index;return e.parent.children.length>n?e.parent.children[n]:null}move_node(e,t,n,i){return d.is_node(e)?(n||(n=e.parent.id),this._move_node(e,t,n,i)):(r.error("the parameter node "+e+" is not a node."),null)}_flow_node_direction(e,t){void 0===t?t=e.direction:e.direction=t;for(var n=e.children.length;n--;)this._flow_node_direction(e.children[n],t)}_move_node_internal(e,t){if(e&&t)if("_last_"==t)e.index=-1,this._update_index(e.parent);else if("_first_"==t)e.index=0,this._update_index(e.parent);else{var n=t?this.get_node(t):null;null!=n&&null!=n.parent&&n.parent.id==e.parent.id&&(e.index=n.index-.5,this._update_index(e.parent))}return e}_move_node(e,n,i,o){if(e&&i){var s=this.get_node(i);if(d.inherited(e,s))return r.error("can not move a node to its children"),null;if(e.parent.id!=i){for(var a=e.parent.children,l=a.length;l--;)if(a[l].id==e.id){a.splice(l,1);break}let t=e.parent;e.parent=s,s.children.push(e),this._update_index(t)}e.parent.isroot?o==t.left?e.direction=o:e.direction=t.right:e.direction=e.parent.direction,this._move_node_internal(e,n),this._flow_node_direction(e)}return e}remove_node(e){if(!d.is_node(e))return r.error("the parameter node "+e+" is not a node."),!1;if(e.isroot)return r.error("fail, can not remove root node"),!1;null!=this.selected&&this.selected.id==e.id&&(this.selected=null);for(var t=e.children,n=t.length;n--;)this.remove_node(t[n]);t.length=0;for(var i=e.parent,o=i.children,s=o.length;s--;)if(o[s].id==e.id){o.splice(s,1);break}for(var a in delete this.nodes[e.id],e)delete e[a];return e=null,this._update_index(i),!0}_put_node(e){return e.id in this.nodes?(r.warn("the node_id '"+e.id+"' has been already exist."),!1):(this.nodes[e.id]=e,!0)}_update_index(e){if(e instanceof d){e.children.sort(d.compare);for(var t=0;t<e.children.length;t++)e.children[t].index=t+1}}}const _={name:"jsMind",author:"hizzgdev@163.com",version:e},u={node_tree:{example:{meta:_,format:"node_tree",data:{id:"root",topic:"jsMind node_tree example"}},get_mind:function(e){var t=u.node_tree,n=new h;return n.name=e.meta.name,n.author=e.meta.author,n.version=e.meta.version,t._parse(n,e.data),n},get_data:function(e){var t=u.node_tree,n={};return n.meta={name:e.name,author:e.author,version:e.version},n.format="node_tree",n.data=t._build_node(e.root),n},_parse:function(e,t){var n=u.node_tree,i=n._extract_data(t);if(e.set_root(t.id,t.topic,i),"children"in t)for(var o=t.children,r=0;r<o.length;r++)n._extract_subnode(e,e.root,o[r])},_extract_data:function(e){var t={};for(var n in e)"id"!=n&&"topic"!=n&&"children"!=n&&"direction"!=n&&"expanded"!=n&&(t[n]=e[n]);return t},_extract_subnode:function(e,n,i){var o=u.node_tree,r=o._extract_data(i),s=null;n.isroot&&(s="left"==i.direction?t.left:t.right);var a=e.add_node(n,i.id,i.topic,r,s,i.expanded);if(i.children)for(var l=i.children,d=0;d<l.length;d++)o._extract_subnode(e,a,l[d])},_build_node:function(e){var n=u.node_tree;if(e instanceof d){var i={id:e.id,topic:e.topic,expanded:e.expanded};if(e.parent&&e.parent.isroot&&(i.direction=e.direction==t.left?"left":"right"),null!=e.data){var o=e.data;for(var r in o)i[r]=o[r]}var s=e.children;if(s.length>0){i.children=[];for(var a=0;a<s.length;a++)i.children.push(n._build_node(s[a]))}return i}}},node_array:{example:{meta:_,format:"node_array",data:[{id:"root",topic:"jsMind node_array example",isroot:!0}]},get_mind:function(e){var t=u.node_array,n=new h;return n.name=e.meta.name,n.author=e.meta.author,n.version=e.meta.version,t._parse(n,e.data),n},get_data:function(e){var t=u.node_array,n={};return n.meta={name:e.name,author:e.author,version:e.version},n.format="node_array",n.data=[],t._array(e,n.data),n},_parse:function(e,t){var n=u.node_array,i=t.slice(0);i.reverse();var o=n._extract_root(e,i);o?n._extract_subnode(e,o,i):r.error("root node can not be found")},_extract_root:function(e,t){for(var n=u.node_array,i=t.length;i--;)if("isroot"in t[i]&&t[i].isroot){var o=t[i],r=n._extract_data(o),s=e.set_root(o.id,o.topic,r);return t.splice(i,1),s}return null},_extract_subnode:function(e,n,i){for(var o=u.node_array,r=i.length,s=null,a=null,l=0;r--;)if((s=i[r]).parentid==n.id){a=o._extract_data(s);var d=null,h=s.direction;h&&(d="left"==h?t.left:t.right);var _=e.add_node(n,s.id,s.topic,a,d,s.expanded);i.splice(r,1),l++;var c=o._extract_subnode(e,_,i);c>0&&(r=i.length,l+=c)}return l},_extract_data:function(e){var t={};for(var n in e)"id"!=n&&"topic"!=n&&"parentid"!=n&&"isroot"!=n&&"direction"!=n&&"expanded"!=n&&(t[n]=e[n]);return t},_array:function(e,t){u.node_array._array_node(e.root,t)},_array_node:function(e,n){var i=u.node_array;if(e instanceof d){var o={id:e.id,topic:e.topic,expanded:e.expanded};if(e.parent&&(o.parentid=e.parent.id),e.isroot&&(o.isroot=!0),e.parent&&e.parent.isroot&&(o.direction=e.direction==t.left?"left":"right"),null!=e.data){var r=e.data;for(var s in r)o[s]=r[s]}n.push(o);for(var a=e.children.length,l=0;l<a;l++)i._array_node(e.children[l],n)}}},freemind:{example:{meta:_,format:"freemind",data:'<map version="1.0.1"><node ID="root" TEXT="jsMind freemind example"/></map>'},get_mind:function(e){var t=u.freemind,n=new h;n.name=e.meta.name,n.author=e.meta.author,n.version=e.meta.version;var i=e.data,o=t._parse_xml(i),r=t._find_root(o);return t._load_node(n,null,r),n},get_data:function(e){var t=u.freemind,n={};n.meta={name:e.name,author:e.author,version:e.version},n.format="freemind";var i=[];return i.push('<map version="1.0.1">'),t._build_map(e.root,i),i.push("</map>"),n.data=i.join(""),n},_parse_xml:function(e){var t=null;return window.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e)),t},_find_root:function(e){for(var t=e.childNodes,n=null,i=null,o=0;o<t.length;o++)if(1==(i=t[o]).nodeType&&"map"==i.tagName){n=i;break}if(n){var r=n.childNodes;for(n=null,o=0;o<r.length;o++)if(1==(i=r[o]).nodeType&&"node"==i.tagName){n=i;break}}return n},_load_node:function(e,n,i){var o=u.freemind,r=i.getAttribute("ID"),s=i.getAttribute("TEXT"),a=i.getAttribute("FOLDED");if(null==s)for(var l=i.childNodes,d=null,h=0;h<l.length;h++)if(1==(d=l[h]).nodeType&&"richcontent"===d.tagName){s=d.textContent;break}var _=o._load_attributes(i),c="expanded"in _?"true"==_.expanded:"true"!=a;delete _.expanded;var f=i.getAttribute("POSITION"),p=null;f&&(p="left"==f?t.left:t.right);var v=null;v=n?e.add_node(n,r,s,_,p,c):e.set_root(r,s,_);var g=i.childNodes,m=null;for(h=0;h<g.length;h++)1==(m=g[h]).nodeType&&"node"==m.tagName&&o._load_node(e,v,m)},_load_attributes:function(e){for(var t=e.childNodes,n=null,i={},o=0;o<t.length;o++)1==(n=t[o]).nodeType&&"attribute"===n.tagName&&(i[n.getAttribute("NAME")]=n.getAttribute("VALUE"));return i},_build_map:function(e,n){var i=u.freemind,o=null;e.parent&&e.parent.isroot&&(o=e.direction===t.left?"left":"right"),n.push("<node"),n.push(' ID="'+e.id+'"'),o&&n.push(' POSITION="'+o+'"'),e.expanded||n.push(' FOLDED="true"'),n.push(' TEXT="'+i._escape(e.topic)+'">');var r=e.data;if(null!=r)for(var s in r)n.push('<attribute NAME="'+s+'" VALUE="'+r[s]+'"/>');for(var a=e.children,l=0;l<a.length;l++)i._build_map(a[l],n);n.push("</node>")},_escape:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}},text:{example:{meta:_,format:"text",data:"jsMind text example\n node1\n  node1-sub\n  node1-sub\n node2"},_line_regex:/\s*/,get_mind:function(e){var t=u.text,n=new h;n.name=e.meta.name,n.author=e.meta.author,n.version=e.meta.version;var i=e.data.split(/\n|\r/);return t._fill_nodes(n,i,0,0),n},_fill_nodes:function(e,t){let n=[],i=0;for(;i<t.length;){let o=t[i],r=o.match(/\s*/)[0].length,s=o.substr(r);if(0==r&&n.length>0)return void log.error("more than 1 root node was found: "+s);if(r>n.length)return void log.error("a suspended node was found: "+s);let l=n.length-r;for(;l--;)n.pop();if(0==r&&0==n.length){let t=e.set_root(a.uuid.newid(),s);n.push(t)}else{let t=e.add_node(n[r-1],a.uuid.newid(),s,{},null);n.push(t)}i++}n.length=0},get_data:function(e){var t=u.text,n={};n.meta={name:e.name,author:e.author,version:e.version},n.format="text";let i=[];return t._build_lines(i,[e.root],0),n.data=i.join("\n"),n},_build_lines:function(e,t,n){let i=new Array(n+1).join(" ");for(let o of t)e.push(i+o.topic),o.children&&u.text._build_lines(e,o.children,n+1)}}};class c{constructor(e){this.jm=e}init(){r.debug("data.init")}reset(){r.debug("data.reset")}load(e){var t=null,n=null;return"node_array"==(t="object"==typeof e?e.format?e.format:"node_tree":"freemind")?n=u.node_array.get_mind(e):"node_tree"==t?n=u.node_tree.get_mind(e):"freemind"==t?n=u.freemind.get_mind(e):"text"==t?n=u.text.get_mind(e):r.warn("unsupported format"),n}get_data(e){var t=null;return"node_array"==e?t=u.node_array.get_data(this.jm.mind):"node_tree"==e?t=u.node_tree.get_data(this.jm.mind):"freemind"==e?t=u.freemind.get_data(this.jm.mind):"text"==e?t=u.text.get_data(this.jm.mind):r.error("unsupported "+e+" format"),t}}class f{constructor(e,t){this.opts=t,this.jm=e,this.isside="side"==this.opts.mode,this.bounds=null,this.cache_valid=!1}init(){r.debug("layout.init")}reset(){r.debug("layout.reset"),this.bounds={n:0,s:0,w:0,e:0}}calculate_next_child_direction(e){if(this.isside)return t.right;for(var n=e.children||[],i=n.length,o=0,r=0;r<i;r++)n[r].direction===t.left?o--:o++;return i>1&&o>0?t.left:t.right}layout(){r.debug("layout.layout"),this.layout_direction(),this.layout_offset()}layout_direction(){this._layout_direction_root()}_layout_direction_root(){var e=this.jm.mind.root,n=null;"layout"in e._data?n=e._data.layout:(n={},e._data.layout=n);var i=e.children,o=i.length;if(n.direction=t.center,n.side_index=0,this.isside)for(var r=o;r--;)this._layout_direction_side(i[r],t.right,r);else{r=o;for(var s=null;r--;)(s=i[r]).direction==t.left?this._layout_direction_side(s,t.left,r):this._layout_direction_side(s,t.right,r)}}_layout_direction_side(e,t,n){var i=null;"layout"in e._data?i=e._data.layout:(i={},e._data.layout=i);var o=e.children,r=o.length;i.direction=t,i.side_index=n;for(var s=r;s--;)this._layout_direction_side(o[s],t,s)}layout_offset(){var e=this.jm.mind.root,n=e._data.layout;n.offset_x=0,n.offset_y=0,n.outer_height=0;for(var i=e.children,o=i.length,r=[],s=[],a=null;o--;)(a=i[o])._data.layout.direction==t.right?s.unshift(a):r.unshift(a);n.left_nodes=r,n.right_nodes=s,n.outer_height_left=this._layout_offset_subnodes(r),n.outer_height_right=this._layout_offset_subnodes(s),this.bounds.e=e._data.view.width/2,this.bounds.w=0-this.bounds.e,this.bounds.n=0,this.bounds.s=Math.max(n.outer_height_left,n.outer_height_right)}_layout_offset_subnodes(e){for(var t=0,n=e.length,i=n,o=null,r=0,s=null,a=0,l=null;i--;)s=(o=e[i])._data.layout,null==l&&(l=o.parent._data),r=this._layout_offset_subnodes(o.children),o.expanded||(r=0,this.set_visible(o.children,!1)),r=Math.max(o._data.view.height,r),o.children.length>1&&(r+=this.opts.cousin_space),s.outer_height=r,s.offset_y=a-r/2,s.offset_x=this.opts.hspace*s.direction+l.view.width*(l.layout.direction+s.direction)/2,o.parent.isroot||(s.offset_x+=this.opts.pspace*s.direction),a=a-r-this.opts.vspace,t+=r;n>1&&(t+=this.opts.vspace*(n-1)),i=n;for(var d=t/2;i--;)(o=e[i])._data.layout.offset_y+=d;return t}_layout_offset_subnodes_height(e){for(var t=0,n=e.length,i=n,o=null,r=0,s=null,a=0,l=null;i--;)s=(o=e[i])._data.layout,null==l&&(l=o.parent._data),r=this._layout_offset_subnodes_height(o.children),o.expanded||(r=0),r=Math.max(o._data.view.height,r),o.children.length>1&&(r+=this.opts.cousin_space),s.outer_height=r,s.offset_y=a-r/2,a=a-r-this.opts.vspace,t+=r;n>1&&(t+=this.opts.vspace*(n-1)),i=n;for(var d=t/2;i--;)(o=e[i])._data.layout.offset_y+=d;return t}get_node_offset(e){var t=e._data.layout,n=null;if("_offset_"in t&&this.cache_valid?n=t._offset_:(n={x:-1,y:-1},t._offset_=n),-1==n.x||-1==n.y){var i=t.offset_x,o=t.offset_y;if(!e.isroot){var r=this.get_node_offset(e.parent);i+=r.x,o+=r.y}n.x=i,n.y=o}return n}get_node_point(e){var t=e._data.view,n=this.get_node_offset(e),i={};return i.x=n.x+t.width*(e._data.layout.direction-1)/2,i.y=n.y-t.height/2,i}get_node_point_in(e){return this.get_node_offset(e)}get_node_point_out(e){var t=e._data.layout,n=null;if("_pout_"in t&&this.cache_valid?n=t._pout_:(n={x:-1,y:-1},t._pout_=n),-1==n.x||-1==n.y)if(e.isroot)n.x=0,n.y=0;else{var i=e._data.view,o=this.get_node_offset(e);n.x=o.x+(i.width+this.opts.pspace)*e._data.layout.direction,n.y=o.y}return n}get_expander_point(e){var n=this.get_node_point_out(e),i={};return e._data.layout.direction==t.right?i.x=n.x-this.opts.pspace:i.x=n.x,i.y=n.y-Math.ceil(this.opts.pspace/2),i}get_min_size(){var e=this.jm.mind.nodes,t=null,n=null;for(var i in e)t=e[i],(n=this.get_node_point_out(t)).x>this.bounds.e&&(this.bounds.e=n.x),n.x<this.bounds.w&&(this.bounds.w=n.x);return{w:this.bounds.e-this.bounds.w,h:this.bounds.s-this.bounds.n}}toggle_node(e){e.isroot||(e.expanded?this.collapse_node(e):this.expand_node(e))}expand_node(e){e.expanded=!0,this.part_layout(e),this.set_visible(e.children,!0),this.jm.invoke_event_handle(n.show,{evt:"expand_node",data:[],node:e.id})}collapse_node(e){e.expanded=!1,this.part_layout(e),this.set_visible(e.children,!1),this.jm.invoke_event_handle(n.show,{evt:"collapse_node",data:[],node:e.id})}expand_all(){var e,t=this.jm.mind.nodes,n=0;for(var i in t)(e=t[i]).expanded||(e.expanded=!0,n++);if(n>0){var o=this.jm.mind.root;this.part_layout(o),this.set_visible(o.children,!0)}}collapse_all(){var e,t=this.jm.mind.nodes,n=0;for(var i in t)(e=t[i]).expanded&&!e.isroot&&(e.expanded=!1,n++);if(n>0){var o=this.jm.mind.root;this.part_layout(o),this.set_visible(o.children,!0)}}expand_to_depth(e,t,n){if(!(e<1))for(var i=t||this.jm.mind.root.children,o=n||1,r=i.length,s=null;r--;)s=i[r],o<e&&(s.expanded||this.expand_node(s),this.expand_to_depth(e,s.children,o+1)),o==e&&s.expanded&&this.collapse_node(s)}part_layout(e){var n=this.jm.mind.root;if(n){var i=n._data.layout;e.isroot?(i.outer_height_right=this._layout_offset_subnodes_height(i.right_nodes),i.outer_height_left=this._layout_offset_subnodes_height(i.left_nodes)):e._data.layout.direction==t.right?i.outer_height_right=this._layout_offset_subnodes_height(i.right_nodes):i.outer_height_left=this._layout_offset_subnodes_height(i.left_nodes),this.bounds.s=Math.max(i.outer_height_left,i.outer_height_right),this.cache_valid=!1}else r.warn("can not found root node")}set_visible(e,t){for(var n=e.length,i=null;n--;)(i=e[n])._data.layout,i.expanded?this.set_visible(i.children,t):this.set_visible(i.children,!1),i.isroot||(i._data.layout.visible=t)}is_expand(e){return e.expanded}is_visible(e){var t=e._data.layout;return!("visible"in t&&!t.visible)}}class p{constructor(e){this.view=e,this.opts=e.opts,this.e_svg=p.c("svg"),this.e_svg.setAttribute("class","jsmind"),this.size={w:0,h:0},this.lines=[],this.line_drawing={straight:this._line_to,curved:this._bezier_to},this.init_line_render()}static c(e){return s.d.createElementNS("http://www.w3.org/2000/svg",e)}init_line_render(){"function"==typeof this.opts.custom_line_render?this.drawing=(e,t,n,i,o)=>{try{this.opts.custom_line_render.call(this,{ctx:e,start_point:{x:t,y:n},end_point:{x:i,y:o}})}catch(e){r.error("custom line renderer error: ",e)}}:this.drawing=this.line_drawing[this.opts.line_style]||this.line_drawing.curved}element(){return this.e_svg}set_size(e,t){this.size.w=e,this.size.h=t,this.e_svg.setAttribute("width",e),this.e_svg.setAttribute("height",t)}clear(){for(var e=this.lines.length;e--;)this.e_svg.removeChild(this.lines[e]);this.lines.length=0}draw_line(e,t,n,i){var o=p.c("path");o.setAttribute("stroke",i||this.opts.line_color),o.setAttribute("stroke-width",this.opts.line_width),o.setAttribute("fill","transparent"),this.lines.push(o),this.e_svg.appendChild(o),this.drawing(o,t.x+n.x,t.y+n.y,e.x+n.x,e.y+n.y)}copy_to(e,t){var n=new Image;n.onload=function(){e.drawImage(n,0,0),t&&t()},n.src="data:image/svg+xml;base64,"+btoa((new XMLSerializer).serializeToString(this.e_svg))}_bezier_to(e,t,n,i,o){e.setAttribute("d","M "+t+" "+n+" C "+(t+2*(i-t)/3)+" "+n+", "+t+" "+o+", "+i+" "+o)}_line_to(e,t,n,i,o){e.setAttribute("d","M "+t+" "+n+" L "+i+" "+o)}}class v{constructor(e){this.opts=e.opts,this.e_canvas=s.c("canvas"),this.e_canvas.className="jsmind",this.canvas_ctx=this.e_canvas.getContext("2d"),this.size={w:0,h:0},this.line_drawing={straight:this._line_to,curved:this._bezier_to},this.dpr=e.device_pixel_ratio,this.init_line_render()}init_line_render(){"function"==typeof this.opts.custom_line_render?this.drawing=(e,t,n,i,o)=>{try{this.opts.custom_line_render.call(this,{ctx:e,start_point:{x:t,y:n},end_point:{x:i,y:o}})}catch(e){r.error("custom line render error: ",e)}}:this.drawing=this.line_drawing[this.opts.line_style]||this.line_drawing.curved}element(){return this.e_canvas}set_size(e,t){this.size.w=e,this.size.h=t,this.e_canvas.width&&this.e_canvas.height&&this.canvas_ctx.scale?(this.e_canvas.width=e*this.dpr,this.e_canvas.height=t*this.dpr,this.e_canvas.style.width=e+"px",this.e_canvas.style.height=t+"px",this.canvas_ctx.scale(this.dpr,this.dpr)):(this.e_canvas.width=e,this.e_canvas.height=t)}clear(){this.canvas_ctx.clearRect(0,0,this.size.w,this.size.h)}draw_line(e,t,n,i){var o=this.canvas_ctx;o.strokeStyle=i||this.opts.line_color,o.lineWidth=this.opts.line_width,o.lineCap="round",this.drawing(o,t.x+n.x,t.y+n.y,e.x+n.x,e.y+n.y)}copy_to(e,t){e.drawImage(this.e_canvas,0,0,this.size.w,this.size.h),t&&t()}_bezier_to(e,t,n,i,o){e.beginPath(),e.moveTo(t,n),e.bezierCurveTo(t+2*(i-t)/3,n,t,o,i,o),e.stroke()}_line_to(e,t,n,i,o){e.beginPath(),e.moveTo(t,n),e.lineTo(i,o),e.stroke()}}class g{constructor(e,t){this.opts=t,this.jm=e,this.layout=e.layout,this.container=null,this.e_panel=null,this.e_nodes=null,this.size={w:0,h:0},this.selected_node=null,this.editing_node=null,this.graph=null,this.render_node=t.custom_node_render?this._custom_node_render:this._default_node_render,this.zoom_current=1,this.device_pixel_ratio=this.opts.enable_device_pixel_ratio&&s.w.devicePixelRatio||1,this._initialized=!1}init(){if(r.debug(this.opts),r.debug("view.init"),this.container=s.i(this.opts.container)?this.opts.container:s.g(this.opts.container),this.container){var e;this.graph=(e=this,"svg"===this.opts.engine.toLowerCase()?new p(e):new v(e)),this.e_panel=s.c("div"),this.e_nodes=s.c("jmnodes"),this.e_editor=s.c("input"),this.e_panel.className="jsmind-inner jmnode-overflow-"+this.opts.node_overflow,this.e_panel.tabIndex=1,this.e_panel.appendChild(this.graph.element()),this.e_panel.appendChild(this.e_nodes),this.e_editor.className="jsmind-editor",this.e_editor.type="text";var t=this;s.on(this.e_editor,"keydown",(function(e){var n=e||event;13==n.keyCode&&(t.edit_node_end(),n.stopPropagation())})),s.on(this.e_editor,"blur",(function(e){t.edit_node_end()})),this.container.appendChild(this.e_panel),this.container.offsetParent||new IntersectionObserver(((e,t)=>{e[0].isIntersecting&&(t.unobserve(this.e_panel),this.resize())})).observe(this.e_panel)}else r.error("the options.view.container was not be found in dom")}add_event(e,t,n,i){let o=i?this.e_panel:this.e_nodes;s.on(o,t,(function(t){var i=t||event;n.call(e,i)}))}get_binded_nodeid(e){if(null==e)return null;var t=e.tagName.toLowerCase();return"jmnode"==t||"jmexpander"==t?e.getAttribute("nodeid"):"jmnodes"==t||"body"==t||"html"==t?null:this.get_binded_nodeid(e.parentElement)}is_node(e){if(null==e)return!1;var t=e.tagName.toLowerCase();return"jmnode"==t||"jmnodes"!=t&&"body"!=t&&"html"!=t&&this.is_node(e.parentElement)}is_expander(e){return"jmexpander"==e.tagName.toLowerCase()}reset(){r.debug("view.reset"),this.selected_node=null,this.clear_lines(),this.clear_nodes(),this.reset_theme()}reset_theme(){var e=this.jm.options.theme;this.e_nodes.className=e?"theme-"+e:""}reset_custom_style(){var e=this.jm.mind.nodes;for(var t in e)this.reset_node_custom_style(e[t])}load(){r.debug("view.load"),this.setup_canvas_draggable(this.opts.draggable),this.init_nodes(),this._initialized=!0}expand_size(){var e=this.layout.get_min_size(),t=e.w+2*this.opts.hmargin,n=e.h+2*this.opts.vmargin,i=this.e_panel.clientWidth,o=this.e_panel.clientHeight;i<t&&(i=t),o<n&&(o=n),this.size.w=i,this.size.h=o}init_nodes_size(e){var t=e._data.view;t.width=t.element.clientWidth,t.height=t.element.clientHeight}init_nodes(){var e=this.jm.mind.nodes,t=s.d.createDocumentFragment();for(var n in e)this.create_node_element(e[n],t);this.e_nodes.appendChild(t),this.run_in_c11y_mode_if_needed((()=>{for(var t in e)this.init_nodes_size(e[t])}))}add_node(e){this.create_node_element(e,this.e_nodes),this.run_in_c11y_mode_if_needed((()=>{this.init_nodes_size(e)}))}run_in_c11y_mode_if_needed(e){this.container.offsetParent?e():(r.warn("init nodes in compatibility mode. because the container or its parent has style {display:none}. "),this.e_panel.style.position="absolute",this.e_panel.style.top="-100000",s.d.body.appendChild(this.e_panel),e(),this.container.appendChild(this.e_panel),this.e_panel.style.position=null,this.e_panel.style.top=null)}create_node_element(e,t){var n=null;"view"in e._data?n=e._data.view:(n={},e._data.view=n);var i=s.c("jmnode");if(e.isroot)i.className="root";else{var o=s.c("jmexpander");s.t(o,"-"),o.setAttribute("nodeid",e.id),o.style.visibility="hidden",t.appendChild(o),n.expander=o}e.topic&&this.render_node(i,e),i.setAttribute("nodeid",e.id),i.style.visibility="hidden",this._reset_node_custom_style(i,e.data),t.appendChild(i),n.element=i}remove_node(e){null!=this.selected_node&&this.selected_node.id==e.id&&(this.selected_node=null),null!=this.editing_node&&this.editing_node.id==e.id&&(e._data.view.element.removeChild(this.e_editor),this.editing_node=null);for(var t=e.children,n=t.length;n--;)this.remove_node(t[n]);if(e._data.view){var i=e._data.view.element,o=e._data.view.expander;this.e_nodes.removeChild(i),this.e_nodes.removeChild(o),e._data.view.element=null,e._data.view.expander=null}}update_node(e){var t=e._data.view,n=t.element;if(e.topic&&this.render_node(n,e),this.layout.is_visible(e))t.width=n.clientWidth,t.height=n.clientHeight;else{let e=n.getAttribute("style");n.style="visibility: visible; left:0; top:0;",t.width=n.clientWidth,t.height=n.clientHeight,n.style=e}}select_node(e){if(this.selected_node){var t=this.selected_node._data.view.element;t.className=t.className.replace(/\s*selected\b/i,""),this.restore_selected_node_custom_style(this.selected_node)}e&&(this.selected_node=e,e._data.view.element.className+=" selected",this.clear_selected_node_custom_style(e))}select_clear(){this.select_node(null)}get_editing_node(){return this.editing_node}is_editing(){return!!this.editing_node}edit_node_begin(e){if(e.topic){null!=this.editing_node&&this.edit_node_end(),this.editing_node=e;var t=e._data.view.element,n=e.topic,i=getComputedStyle(t);this.e_editor.value=n,this.e_editor.style.width=t.clientWidth-parseInt(i.getPropertyValue("padding-left"))-parseInt(i.getPropertyValue("padding-right"))+"px",t.innerHTML="",t.appendChild(this.e_editor),t.style.zIndex=5,this.e_editor.focus(),this.e_editor.select()}else r.warn("don't edit image nodes")}edit_node_end(){if(null!=this.editing_node){var e=this.editing_node;this.editing_node=null;var t=e._data.view.element,n=this.e_editor.value;t.style.zIndex="auto",t.removeChild(this.e_editor),a.text.is_empty(n)||e.topic===n?this.render_node(t,e):this.jm.update_node(e.id,n)}this.e_panel.focus()}get_view_offset(){var e=this.layout.bounds;return{x:(this.size.w-e.e-e.w)/2,y:this.size.h/2}}resize(){this.graph.set_size(1,1),this.e_nodes.style.width="1px",this.e_nodes.style.height="1px",this.expand_size(),this._show()}_show(){this.graph.set_size(this.size.w,this.size.h),this.e_nodes.style.width=this.size.w+"px",this.e_nodes.style.height=this.size.h+"px",this.show_nodes(),this.show_lines(),this.jm.invoke_event_handle(n.resize,{data:[]})}zoom_in(e){return this.set_zoom(this.zoom_current+this.opts.zoom.step,e)}zoom_out(e){return this.set_zoom(this.zoom_current-this.opts.zoom.step,e)}set_zoom(e,t){if(e<this.opts.zoom.min||e>this.opts.zoom.max)return!1;let n=this.e_panel.getBoundingClientRect();if(e<1&&e<this.zoom_current&&this.size.w*e<n.width&&this.size.h*e<n.height)return!1;let i=t?{x:t.x-n.x,y:t.y-n.y}:{x:n.width/2,y:n.height/2},o=(this.e_panel.scrollLeft+i.x)*e/this.zoom_current-i.x,r=(this.e_panel.scrollTop+i.y)*e/this.zoom_current-i.y;this.zoom_current=e;for(var s=0;s<this.e_panel.children.length;s++)this.e_panel.children[s].style.zoom=e;return this._show(),this.e_panel.scrollLeft=o,this.e_panel.scrollTop=r,!0}show(e){r.debug(`view.show: {keep_center: ${e}}`),this.expand_size(),this._show(),e&&this.center_node(this.jm.mind.root)}relayout(){this.expand_size(),this._show()}save_location(e){var t=e._data.view;t._saved_location={x:parseInt(t.element.style.left)-this.e_panel.scrollLeft,y:parseInt(t.element.style.top)-this.e_panel.scrollTop}}restore_location(e){var t=e._data.view;this.e_panel.scrollLeft=parseInt(t.element.style.left)-t._saved_location.x,this.e_panel.scrollTop=parseInt(t.element.style.top)-t._saved_location.y}clear_nodes(){var e=this.jm.mind;if(null!=e){var t=e.nodes,n=null;for(var i in t)(n=t[i])._data.view.element=null,n._data.view.expander=null;this.e_nodes.innerHTML=""}}show_nodes(){var e=this.jm.mind.nodes,t=null,n=null,i=null,o=null,r=this.get_view_offset();for(var s in e)n=(o=(t=e[s])._data.view).element,this.layout.is_visible(t)?(this.reset_node_custom_style(t),i=this.layout.get_node_point(t),o.abs_x=r.x+i.x,o.abs_y=r.y+i.y,n.style.left=r.x+i.x+"px",n.style.top=r.y+i.y+"px",n.style.display="",n.style.visibility="visible",this._show_expander(t,r)):(n.style.display="none",o.expander.style.display="none")}_show_expander(e,t){if(e.isroot)return;var n=e._data.view.expander;if(0==e.children.length)return n.style.display="none",void(n.style.visibility="hidden");let i=this._get_expander_text(e);s.t(n,i);let o=this.layout.get_expander_point(e);n.style.left=t.x+o.x+"px",n.style.top=t.y+o.y+"px",n.style.display="",n.style.visibility="visible"}_get_expander_text(e){let t=this.opts.expander_style?this.opts.expander_style.toLowerCase():"char";return"number"===t?e.children.length>99?"...":e.children.length:"char"===t?e.expanded?"-":"+":void 0}_default_node_render(e,t){this.opts.support_html?s.h(e,t.topic):s.t(e,t.topic)}_custom_node_render(e,t){this.opts.custom_node_render(this.jm,e,t)||this._default_node_render(e,t)}reset_node_custom_style(e){this._reset_node_custom_style(e._data.view.element,e.data)}_reset_node_custom_style(e,t){if("background-color"in t&&(e.style.backgroundColor=t["background-color"]),"foreground-color"in t&&(e.style.color=t["foreground-color"]),"width"in t&&(e.style.width=t.width+"px"),"height"in t&&(e.style.height=t.height+"px"),"font-size"in t&&(e.style.fontSize=t["font-size"]+"px"),"font-weight"in t&&(e.style.fontWeight=t["font-weight"]),"font-style"in t&&(e.style.fontStyle=t["font-style"]),"background-image"in t){var n=t["background-image"];if(n.startsWith("data")&&t.width&&t.height){var i=new Image;i.onload=function(){var t=s.c("canvas");if(t.width=e.clientWidth,t.height=e.clientHeight,t.getContext){t.getContext("2d").drawImage(this,2,2,e.clientWidth,e.clientHeight);var n=t.toDataURL();e.style.backgroundImage="url("+n+")"}},i.src=n}else e.style.backgroundImage="url("+n+")";e.style.backgroundSize="99%","background-rotation"in t&&(e.style.transform="rotate("+t["background-rotation"]+"deg)")}}restore_selected_node_custom_style(e){var t=e._data.view.element,n=e.data;"background-color"in n&&(t.style.backgroundColor=n["background-color"]),"foreground-color"in n&&(t.style.color=n["foreground-color"])}clear_selected_node_custom_style(e){var t=e._data.view.element;t.style.backgroundColor="",t.style.color=""}clear_lines(){this.graph.clear()}show_lines(){this.clear_lines();var e=this.jm.mind.nodes,t=null,n=null,i=null,o=null,r=this.get_view_offset();for(var s in e)(t=e[s]).isroot||this.layout.is_visible(t)&&(n=this.layout.get_node_point_in(t),i=this.layout.get_node_point_out(t.parent),o=t.data["leading-line-color"],this.graph.draw_line(i,n,r,o))}setup_canvas_draggable(e){if(this.opts.draggable=e,!this._initialized){let e,t,n=!1;this.opts.hide_scrollbars_when_draggable&&(this.e_panel.style="overflow: hidden"),s.on(this.container,"mousedown",(i=>{this.opts.draggable&&(n=!0,e=i.clientX,t=i.clientY)})),s.on(this.container,"mouseup",(()=>{n=!1})),s.on(this.container,"mousemove",(i=>{this.opts.draggable&&n&&(this.e_panel.scrollBy(e-i.clientX,t-i.clientY),e=i.clientX,t=i.clientY)}))}}center_node(e){if(!this.layout.is_visible(e))return r.warn("can not scroll to the node, because it is invisible"),!1;let t=e._data.view,n=this.e_panel.getBoundingClientRect(),i=t.abs_x+t.width/2,o=t.abs_y+t.height/2;return this.e_panel.scrollTo(i*this.zoom_current-n.width/2,o*this.zoom_current-n.height/2),!0}zoomIn(e){return r.warn("please use zoom_in instead"),this.zoom_in(e)}zoomOut(e){return r.warn("please use zoom_out instead"),this.zoom_out(e)}setZoom(e,t){return r.warn("please use set_zoom instead"),this.set_zoom(e,t)}}class m{constructor(e,t){this.jm=e,this.opts=t,this.mapping=t.mapping,this.handles=t.handles,this._newid=null,this._mapping={}}init(){for(var e in s.on(this.jm.view.e_panel,"keydown",this.handler.bind(this)),this.handles.addchild=this.handle_addchild,this.handles.addbrother=this.handle_addbrother,this.handles.editnode=this.handle_editnode,this.handles.delnode=this.handle_delnode,this.handles.toggle=this.handle_toggle,this.handles.up=this.handle_up,this.handles.down=this.handle_down,this.handles.left=this.handle_left,this.handles.right=this.handle_right,this.mapping)if(this.mapping[e]&&e in this.handles){let t=this.mapping[e];Array.isArray(t)||(t=[t]);for(let n of t)this._mapping[n]=this.handles[e]}"function"==typeof this.opts.id_generator?this._newid=this.opts.id_generator:this._newid=a.uuid.newid}enable_shortcut(){this.opts.enable=!0}disable_shortcut(){this.opts.enable=!1}handler(e){if(9==e.which&&e.preventDefault(),!this.jm.view.is_editing()){var t=e||event;if(!this.opts.enable)return!0;var n=t.keyCode+(t.metaKey<<13)+(t.ctrlKey<<12)+(t.altKey<<11)+(t.shiftKey<<10);n in this._mapping&&this._mapping[n].call(this,this.jm,e)}}handle_addchild(e,t){var n=e.get_selected_node();if(n){var i=this._newid();e.add_node(n,i,"New Node")&&(e.select_node(i),e.begin_edit(i))}}handle_addbrother(e,t){var n=e.get_selected_node();if(n&&!n.isroot){var i=this._newid();e.insert_node_after(n,i,"New Node")&&(e.select_node(i),e.begin_edit(i))}}handle_editnode(e,t){var n=e.get_selected_node();n&&e.begin_edit(n)}handle_delnode(e,t){var n=e.get_selected_node();n&&!n.isroot&&(e.select_node(n.parent),e.remove_node(n))}handle_toggle(e,t){var n=t||event,i=e.get_selected_node();i&&(e.toggle_node(i.id),n.stopPropagation(),n.preventDefault())}handle_up(e,t){var n=t||event,i=e.get_selected_node();if(i){var o=e.find_node_before(i);if(!o){var r=e.find_node_before(i.parent);r&&r.children.length>0&&(o=r.children[r.children.length-1])}o&&e.select_node(o),n.stopPropagation(),n.preventDefault()}}handle_down(e,t){var n=t||event,i=e.get_selected_node();if(i){var o=e.find_node_after(i);if(!o){var r=e.find_node_after(i.parent);r&&r.children.length>0&&(o=r.children[0])}o&&e.select_node(o),n.stopPropagation(),n.preventDefault()}}handle_left(e,n){this._handle_direction(e,n,t.left)}handle_right(e,n){this._handle_direction(e,n,t.right)}_handle_direction(e,t,n){var i=t||event,o=e.get_selected_node(),r=null;if(o){if(o.isroot){for(var s=o.children,a=[],l=0;l<s.length;l++)s[l].direction===n&&a.push(l);r=s[a[Math.floor((a.length-1)/2)]]}else if(o.direction===n){var d=(a=o.children).length;d>0&&(r=a[Math.floor((d-1)/2)])}else r=o.parent;r&&e.select_node(r),i.stopPropagation(),i.preventDefault()}}}const w={plugins:[]};function y(e){if(!(e instanceof x))throw new Error("can not register plugin, it is not an instance of Plugin");if(w.plugins.map((e=>e.name)).includes(e.name))throw new Error("can not register plugin "+e.name+": plugin name already exist");w.plugins.push(e)}function b(e,t){s.w.setTimeout((function(){!function(e,t){w.plugins.forEach((n=>n.fn_init(e,t[n.name])))}(e,t)}),0)}class x{constructor(e,t){if(!e)throw new Error("plugin must has a name");if(!t||"function"!=typeof t)throw new Error("plugin must has an init function");this.name=e,this.fn_init=t}}class j{static mind=h;static node=d;static direction=t;static event_type=n;static $=s;static plugin=x;static register_plugin=y;static util=a;constructor(t){j.current=this,this.options=function(e){var t={};if(a.json.merge(t,l),a.json.merge(t,e),!t.container)throw new Error("the options.container should not be null or empty.");return t}(t),r.level(i[this.options.log_level]),this.version=e,this.initialized=!1,this.mind=null,this.event_handles=[],this.init()}init(){if(!this.initialized){this.initialized=!0;var e={mode:this.options.mode,hspace:this.options.layout.hspace,vspace:this.options.layout.vspace,pspace:this.options.layout.pspace,cousin_space:this.options.layout.cousin_space},t={container:this.options.container,support_html:this.options.support_html,engine:this.options.view.engine,enable_device_pixel_ratio:this.options.view.enable_device_pixel_ratio,hmargin:this.options.view.hmargin,vmargin:this.options.view.vmargin,line_width:this.options.view.line_width,line_color:this.options.view.line_color,line_style:this.options.view.line_style,custom_line_render:this.options.view.custom_line_render,draggable:this.options.view.draggable,hide_scrollbars_when_draggable:this.options.view.hide_scrollbars_when_draggable,node_overflow:this.options.view.node_overflow,zoom:this.options.view.zoom,custom_node_render:this.options.view.custom_node_render,expander_style:this.options.view.expander_style};this.data=new c(this),this.layout=new f(this,e),this.view=new g(this,t),this.shortcut=new m(this,this.options.shortcut),this.data.init(),this.layout.init(),this.view.init(),this.shortcut.init(),this._event_bind(),b(this,this.options.plugin)}}get_editable(){return this.options.editable}enable_edit(){this.options.editable=!0}disable_edit(){this.options.editable=!1}get_view_draggable(){return this.options.view.draggable}enable_view_draggable(){this.options.view.draggable=!0,this.view.setup_canvas_draggable(!0)}disable_view_draggable(){this.options.view.draggable=!1,this.view.setup_canvas_draggable(!1)}enable_event_handle(e){this.options.default_event_handle["enable_"+e+"_handle"]=!0}disable_event_handle(e){this.options.default_event_handle["enable_"+e+"_handle"]=!1}set_theme(e){var t=this.options.theme;this.options.theme=e||null,t!=this.options.theme&&(this.view.reset_theme(),this.view.reset_custom_style())}_event_bind(){this.view.add_event(this,"mousedown",this.mousedown_handle),this.view.add_event(this,"click",this.click_handle),this.view.add_event(this,"dblclick",this.dblclick_handle),this.view.add_event(this,"mousewheel",this.mousewheel_handle,!0)}mousedown_handle(e){if(this.options.default_event_handle.enable_mousedown_handle){var t=e.target||event.srcElement,n=this.view.get_binded_nodeid(t);n?this.view.is_node(t)&&this.select_node(n):this.select_clear()}}click_handle(e){if(this.options.default_event_handle.enable_click_handle){var t=e.target||event.srcElement;if(this.view.is_expander(t)){var n=this.view.get_binded_nodeid(t);n&&this.toggle_node(n)}}}dblclick_handle(e){if(this.options.default_event_handle.enable_dblclick_handle&&this.get_editable()){var t=e.target||event.srcElement;if(this.view.is_node(t)){var n=this.view.get_binded_nodeid(t);n&&this.begin_edit(n)}}}mousewheel_handle(e){if(this.options.default_event_handle.enable_mousewheel_handle&&e.ctrlKey){var t=e||event;t.preventDefault(),t.deltaY<0?this.view.zoom_in(t):this.view.zoom_out(t)}}begin_edit(e){if(!d.is_node(e)){var t=this.get_node(e);return t?this.begin_edit(t):(r.error("the node[id="+e+"] can not be found."),!1)}this.get_editable()?this.view.edit_node_begin(e):r.error("fail, this mind map is not editable.")}end_edit(){this.view.edit_node_end()}toggle_node(e){if(!d.is_node(e)){var t=this.get_node(e);return t?this.toggle_node(t):void r.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.toggle_node(e),this.view.relayout(),this.view.restore_location(e))}expand_node(e){if(!d.is_node(e)){var t=this.get_node(e);return t?this.expand_node(t):void r.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.expand_node(e),this.view.relayout(),this.view.restore_location(e))}collapse_node(e){if(!d.is_node(e)){var t=this.get_node(e);return t?this.collapse_node(t):void r.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.collapse_node(e),this.view.relayout(),this.view.restore_location(e))}expand_all(){this.layout.expand_all(),this.view.relayout()}collapse_all(){this.layout.collapse_all(),this.view.relayout()}expand_to_depth(e){this.layout.expand_to_depth(e),this.view.relayout()}_reset(){this.view.reset(),this.layout.reset(),this.data.reset()}_show(e,t){var i=e||u.node_array.example;this.mind=this.data.load(i),this.mind?(r.debug("data.load ok"),this.view.load(),r.debug("view.load ok"),this.layout.layout(),r.debug("layout.layout ok"),this.view.show(!t),r.debug("view.show ok"),this.invoke_event_handle(n.show,{data:[e]})):r.error("data.load error")}show(e,t){this._reset(),this._show(e,t)}get_meta(){return{name:this.mind.name,author:this.mind.author,version:this.mind.version}}get_data(e){var t=e||"node_tree";return this.data.get_data(t)}get_root(){return this.mind.root}get_node(e){return d.is_node(e)?e:this.mind.get_node(e)}add_node(e,i,o,s,a){if(this.get_editable()){var l=this.get_node(e),d=t.of(a);void 0===d&&(d=this.layout.calculate_next_child_direction(l));var h=this.mind.add_node(l,i,o,s,d);return h&&(this.view.add_node(h),this.layout.layout(),this.view.show(!1),this.view.reset_node_custom_style(h),this.expand_node(l),this.invoke_event_handle(n.edit,{evt:"add_node",data:[l.id,i,o,s,d],node:i})),h}return r.error("fail, this mind map is not editable"),null}insert_node_before(e,i,o,s,a){if(this.get_editable()){var l=this.get_node(e),d=t.of(a);void 0===d&&(d=this.layout.calculate_next_child_direction(l.parent));var h=this.mind.insert_node_before(l,i,o,s,d);return h&&(this.view.add_node(h),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(n.edit,{evt:"insert_node_before",data:[l.id,i,o,s,d],node:i})),h}return r.error("fail, this mind map is not editable"),null}insert_node_after(e,i,o,s,a){if(this.get_editable()){var l=this.get_node(e),d=t.of(a);void 0===d&&(d=this.layout.calculate_next_child_direction(l.parent));var h=this.mind.insert_node_after(l,i,o,s,d);return h&&(this.view.add_node(h),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(n.edit,{evt:"insert_node_after",data:[l.id,i,o,s,d],node:i})),h}return r.error("fail, this mind map is not editable"),null}remove_node(e){if(!d.is_node(e)){var t=this.get_node(e);return t?this.remove_node(t):(r.error("the node[id="+e+"] can not be found."),!1)}if(this.get_editable()){if(e.isroot)return r.error("fail, can not remove root node"),!1;var i=e.id,o=e.parent.id,s=this.get_node(o);return this.view.save_location(s),this.view.remove_node(e),this.mind.remove_node(e),this.layout.layout(),this.view.show(!1),this.view.restore_location(s),this.invoke_event_handle(n.edit,{evt:"remove_node",data:[i],node:o}),!0}return r.error("fail, this mind map is not editable"),!1}update_node(e,t){if(this.get_editable())if(a.text.is_empty(t))r.warn("fail, topic can not be empty");else{var i=this.get_node(e);if(i){if(i.topic===t)return r.info("nothing changed"),void this.view.update_node(i);i.topic=t,this.view.update_node(i),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(n.edit,{evt:"update_node",data:[e,t],node:e})}}else r.error("fail, this mind map is not editable")}move_node(e,t,i,o){if(this.get_editable()){var s=this.get_node(e),a=this.mind.move_node(s,t,i,o);a&&(this.view.update_node(a),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(n.edit,{evt:"move_node",data:[e,t,i,o],node:e}))}else r.error("fail, this mind map is not editable")}select_node(e){if(!d.is_node(e)){var t=this.get_node(e);return t?this.select_node(t):void r.error("the node[id="+e+"] can not be found.")}this.layout.is_visible(e)&&(this.mind.selected=e,this.view.select_node(e),this.invoke_event_handle(n.select,{evt:"select_node",data:[],node:e.id}))}get_selected_node(){return this.mind?this.mind.selected:null}select_clear(){this.mind&&(this.mind.selected=null,this.view.select_clear())}is_node_visible(e){return this.layout.is_visible(e)}scroll_node_to_center(e){if(d.is_node(e))this.view.center_node(e);else{var t=this.get_node(e);t?this.scroll_node_to_center(t):r.error("the node[id="+e+"] can not be found.")}}find_node_before(e){if(!d.is_node(e)){var t=this.get_node(e);return t?this.find_node_before(t):void r.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var n=null;if(e.parent.isroot)for(var i=e.parent.children,o=null,s=null,a=0;a<i.length;a++)s=i[a],e.direction===s.direction&&(e.id===s.id&&(n=o),o=s);else n=this.mind.get_node_before(e);return n}find_node_after(e){if(!d.is_node(e)){var t=this.get_node(e);return t?this.find_node_after(t):void r.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var n=null;if(e.parent.isroot){for(var i=e.parent.children,o=!1,s=null,a=0;a<i.length;a++)if(s=i[a],e.direction===s.direction){if(o){n=s;break}e.id===s.id&&(o=!0)}}else n=this.mind.get_node_after(e);return n}set_node_color(e,t,n){if(!this.get_editable())return r.error("fail, this mind map is not editable"),null;var i=this.mind.get_node(e);i&&(t&&(i.data["background-color"]=t),n&&(i.data["foreground-color"]=n),this.view.reset_node_custom_style(i))}set_node_font_style(e,t,n,i){if(!this.get_editable())return r.error("fail, this mind map is not editable"),null;var o=this.mind.get_node(e);o&&(t&&(o.data["font-size"]=t),n&&(o.data["font-weight"]=n),i&&(o.data["font-style"]=i),this.view.reset_node_custom_style(o),this.view.update_node(o),this.layout.layout(),this.view.show(!1))}set_node_background_image(e,t,n,i,o){if(!this.get_editable())return r.error("fail, this mind map is not editable"),null;var s=this.mind.get_node(e);s&&(t&&(s.data["background-image"]=t),n&&(s.data.width=n),i&&(s.data.height=i),o&&(s.data["background-rotation"]=o),this.view.reset_node_custom_style(s),this.view.update_node(s),this.layout.layout(),this.view.show(!1))}set_node_background_rotation(e,t){if(!this.get_editable())return r.error("fail, this mind map is not editable"),null;var n=this.mind.get_node(e);if(n){if(!n.data["background-image"])return r.error("fail, only can change rotation angle of node with background image"),null;n.data["background-rotation"]=t,this.view.reset_node_custom_style(n),this.view.update_node(n),this.layout.layout(),this.view.show(!1)}}resize(){this.view.resize()}add_event_listener(e){"function"==typeof e&&this.event_handles.push(e)}clear_event_listener(){this.event_handles=[]}invoke_event_handle(e,t){var n=this;s.w.setTimeout((function(){n._invoke_event_handle(e,t)}),0)}_invoke_event_handle(e,t){for(var n=this.event_handles.length,i=0;i<n;i++)this.event_handles[i](e,t)}static show(e,t){r.warn("`jsMind.show(options, mind)` is deprecated, please use `jm = new jsMind(options); jm.show(mind);` instead");var n=new j(e);return n.show(t),n}}return j}()},155:t=>{"use strict";t.exports=e}},n={};function i(e){var o=n[e];if(void 0!==o)return o.exports;var r=n[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};return(()=>{"use strict";i.d(o,{default:()=>k});var e=i(900),t=i.n(e),n=(i(114),i(155)),r=i.n(n),s=i(802),a=i.n(s);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,h(i.key),i)}}function h(e){var t=function(e,t){if("object"!=l(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=l(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==l(t)?t:t+""}if(!t())throw new Error("jsMind is not defined");if(!a())throw new Error("dom-to-image is required");var _=t().$,u={filename:null,watermark:{left:"",right:""},background:"#fff"},c=function(){return e=function e(n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o={};t().util.json.merge(o,u),t().util.json.merge(o,i),this.version="0.2.0",this.jm=n,this.options=o,this.dpr=n.view.device_pixel_ratio},(n=[{key:"shoot",value:function(){var e=this,t=this.create_canvas(),n=t.getContext("2d");n.scale(this.dpr,this.dpr),Promise.resolve(n).then((function(){return e.draw_background(n)})).then((function(){return e.draw_lines(n)})).then((function(){return e.draw_nodes(n)})).then((function(){return e.draw_watermark(t,n)})).then((function(){return e.download(t)})).then((function(){return e.clear(t)}))}},{key:"create_canvas",value:function(){var e=_.c("canvas"),t=this.jm.view.size.w,n=this.jm.view.size.h;return e.width=t*this.dpr,e.height=n*this.dpr,e.style.width=t+"px",e.style.height=n+"px",e.style.visibility="hidden",this.jm.view.e_panel.appendChild(e),e}},{key:"clear",value:function(e){e.parentNode.removeChild(e)}},{key:"draw_background",value:function(e){var t=this;return new Promise((function(n,i){var o=t.options.background;o&&"transparent"!==o&&(e.fillStyle=t.options.background,e.fillRect(0,0,t.jm.view.size.w,t.jm.view.size.h)),n(e)}))}},{key:"draw_lines",value:function(e){var t=this;return new Promise((function(n,i){t.jm.view.graph.copy_to(e,(function(){n(e)}))}))}},{key:"draw_nodes",value:function(e){return a().toSvg(this.jm.view.e_nodes,{style:{zoom:1}}).then(this.load_image).then((function(t){return e.drawImage(t,0,0),e}))}},{key:"draw_watermark",value:function(e,t){return t.textBaseline="bottom",t.fillStyle="#000",t.font="11px Verdana,Arial,Helvetica,sans-serif",this.options.watermark.left&&(t.textAlign="left",t.fillText(this.options.watermark.left,5.5,e.height-2.5)),this.options.watermark.right&&(t.textAlign="right",t.fillText(this.options.watermark.right,e.width-5.5,e.height-2.5)),t}},{key:"load_image",value:function(e){return new Promise((function(t,n){var i=new Image;i.onload=function(){t(i)},i.onerror=n,i.src=e}))}},{key:"download",value:function(e){var t=(this.options.filename||this.jm.mind.name)+".png";if("msSaveBlob"in navigator&&e.msToBlob){var n,i=e.msToBlob();null===(n=navigator)||void 0===n||n.msSaveBlob(i,t)}else{var o=e.toDataURL(),r=_.c("a");if("download"in r){r.style.visibility="hidden",r.href=o,r.download=t,_.d.body.appendChild(r);var s=_.d.createEvent("MouseEvents");s.initEvent("click",!0,!0),r.dispatchEvent(s),_.d.body.removeChild(r)}else location.href=o}}}])&&d(e.prototype,n),i&&d(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,i}(),f=new(t().plugin)("screenshot",(function(e,t){var n=new c(e,t);e.screenshot=n,e.shoot=function(){n.shoot()}}));function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}t().register_plugin(f);var v=["data","options"];function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=p(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=p(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==p(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r,s,a=[],l=!0,d=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){d=!0,o=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(d)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}var x={container:"jsmind_container",editable:!0,theme:"primary",mode:"full",support_html:!0,view:{engine:"canvas",hmargin:100,vmargin:50,line_width:2,line_color:"#555",line_style:"curved",custom_line_render:null,draggable:!1,hide_scrollbars_when_draggable:!1,node_overflow:"hidden",zoom:{min:.5,max:2.1,step:.1},custom_node_render:null},layout:{hspace:30,vspace:20,pspace:13,cousin_space:0},shortcut:{enable:!0,handles:{},mapping:{addchild:45,addbrother:13,editnode:113,delnode:46,toggle:32,left:37,up:38,right:39,down:40}}},j=(0,n.forwardRef)((function(e,i){var o=["onClick","onMouseOver","onMouseOut","onMouseLeave","onKeyDown","onKeyUp","ondblClick","onContextMenu"],s=(0,n.useRef)(null),a=(0,n.useRef)(null),l=(0,n.useRef)({}),d=y((0,n.useState)(!1),2),h=d[0],_=d[1],u=e.data,c=e.options,f=void 0===c?{}:c,p=function(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.includes(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,v);(0,n.useImperativeHandle)(i,(function(){return{getInstance:function(){return s.current},screenShot:function(){var e;return null==s||null===(e=s.current)||void 0===e||null===(e=e.screenshot)||void 0===e?void 0:e.shoot()},getData:function(e){var t;return null==s||null===(t=s.current)||void 0===t?void 0:t.get_data(e)},getSelectedNode:function(){var e;return null==s||null===(e=s.current)||void 0===e?void 0:e.get_selected_node()},expandAll:function(){var e;return null==s||null===(e=s.current)||void 0===e?void 0:e.expand_all()},addNode:function(e,t,n,i,o){var r;return null==s||null===(r=s.current)||void 0===r?void 0:r.add_node(e,t,n,i,o)},removeNode:function(e){var t;return!(null==s||null===(t=s.current)||void 0===t||!t.remove_node(e))},updateNode:function(e,t){var n;return null==s||null===(n=s.current)||void 0===n?void 0:n.update_node(e,t)},scrollNodeToCenter:function(e){var t;return null==s||null===(t=s.current)||void 0===t?void 0:t.scroll_node_to_center(e)},setNodeColor:function(e,t,n){var i;return null==s||null===(i=s.current)||void 0===i?void 0:i.set_node_color(e,t,n)},setNodeFontStyle:function(e,t,n,i){var o;return null==s||null===(o=s.current)||void 0===o?void 0:o.set_node_font_style(e,t,n,i)}}}));var g=(0,n.useCallback)((function(t,n){var i;null==t||t.preventDefault();var o=t.target,r=o.getAttribute("nodeid"),a=r&&(null===(i=s.current)||void 0===i?void 0:i.get_node(r));if(a){var l,d="JMNODE"===o.tagName,h="JMEXPANDER"===o.tagName,_=d?n:h?"onExpand":"";_&&(null==e||null===(l=e[_])||void 0===l||l.call(e,a))}}),[]),w=(0,n.useCallback)((function(e){return l.current[e]||(l.current[e]=function(t){return g(t,e)}),l.current[e]}),[g]);return(0,n.useEffect)((function(){var e;f.editable&&s.current?s.current.enable_edit():null===(e=s.current)||void 0===e||e.disable_edit()}),[f]),(0,n.useEffect)((function(){var e;h&&(null==s||null===(e=s.current)||void 0===e||e.show(u))}),[u,h]),(0,n.useEffect)((function(){var e,n=m(m({},x),f);return s.current=new(t())(n),(e=a.current)&&o.forEach((function(t){var n=t.replace(/^on/,"").toLocaleLowerCase();Reflect.has(p,t)&&e.addEventListener(n,w(t))})),_(!0),function(){!function(){var e=a.current;e&&o.forEach((function(t){var n=t.replace(/^on/,"").toLocaleLowerCase();e.removeEventListener(n,l.current[t])}))}()}}),[]),r().createElement("div",{ref:a,id:"jsmind_container",style:{width:"100%",height:"100%"}})}));const k=(0,n.memo)(j)})(),o=o.default})()));